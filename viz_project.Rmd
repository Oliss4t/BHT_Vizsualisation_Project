---
title: Vizualization on the Happines Dataset including Tabacco, Alcohole and Internet
  consumption
author: "Conor Fallon; Tassilo Henninger"
date: "22 6 2022"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(knitr)
library(kableExtra)
library(plotly)
library(scales)
library(GGally)
library(reshape2)
```

## Opening Questions
### What influences happiness?
### Happiness over time?

## Datasets and pre-processing

Our base dataset is the [World Happiness Report](https://www.kaggle.com/datasets/mathurinache/world-happiness-report) ranging from 2015 to 2022. The World Happiness Report is a publication of the United Nations Sustainable Development Solutions Network. It contains articles and rankings of national happiness, based on respondent ratings of their own lives, which the report also correlates with various life factors.
The dataset contains 12 columns, 1237 rows and can be seen in the table below. 
As our goal is to analyse the factors of happiness, the following six columns are most important for us: GDP, Family, Health, Freedom, Corruption and Generosity.
```{r, echo=FALSE}
h_sample_2015 <- read.csv(file = './data/happy/2015.csv')
kable(h_sample_2015[1:3,], "html") %>% kable_styling("striped") %>% scroll_box(width = "100%")
```

In addition, we wanted to add futher factors and added the following three datasets:

* [smoking dataset](https://ourworldindata.org/smoking): 
* [alcohol dataset](https://www.kaggle.com/datasets/pralabhpoudel/alcohol-consumption-by-country?resource=download)
* [internet dataset](https://data.worldbank.org/indicator/IT.NET.USER.ZS)

By merging the datasets we have now four additional factors:

* Prevalence of current tobacco use (% of adults)
* Population (historical estimates)
* Total alcohol consumption per capita (liters of pure alcohol, projected estimates, 15+ years of age)
* Individuals using the Internet (% of population)

To join all the different datasets we had to do some manual preprocessing which can be seen in the [preprocessing](./preprocessing.ipynb) step.
The main steps where cleaning the data (region, countrycode, NaN) and joining the datasets based on the year and the countrycode.

After joining we noticed, that the three additional data sets do not contain data for the whole timespan 2015-2022.(fig. missing values full data)
Therefore, we decided to create two datasets. One for analysing the happiness change over time and one for analysing the influential factors regarding happiness in only one year.

For the first dataset, the [over time analysis]("./data/preprocessed_data_happy_incl_region_no_nan.csv"), we only included the 6 factors from the base happiness dataset and excluded all rows containing missing values. We also renamed the columns for having shorter labels.
```{r, echo=FALSE}
data_over_time <- read.csv(file = './data/preprocessed_data_happy_incl_region_no_nan.csv')
kable(data_over_time[1:3,3:ncol(data_over_time)], "html") %>% kable_styling("striped") %>% scroll_box(width = "100%")
```


For the second dataset, the [influential factors analysis]("./data/preprocessed_data_2018_no_nan.csv"), we inspected the missing values of each year and choose the year with the lowes missing values, year 2018 (fig "missing values 2018"). Then we excluded all rows containing missing values again. Figure "missing values 2017" shows e.g. that the smoking and the alcohol dataset did not contain any values for the year 2017.  We also renamed the columns for having shorter labels.

```{r, echo=FALSE}
data_2018 <- read.csv(file = './data/preprocessed_data_2018_no_nan.csv')
kable(data_2018[1:3,1:ncol(data_2018)], "html") %>% kable_styling("striped") %>% scroll_box(width = "100%")
```

![missing values full data](./figs/full_data_missing_values.png)

![missing values 2017](./figs/2017_missing_values.png)


![missing values 2018](./figs/2018_missing_values.png)

## Preliminary analyses

One of the objectives of preliminary data analysis to get a feel for the data you are dealing with by describing the key features of the data and summarizing the results. We are focusing on the second dataset, the [influential factors analysis dataset]("./data/preprocessed_data_2018_no_nan.csv"), as it contains the most explanatory variables.

### Boxplots, scale data?
```{r echo=FALSE}
correlation_categories <- c("Happiness","Economy","Family","Health","Freedom","Trust","Generosity","Alcohol","Population","Tobacco","Internet")
```
First we check via the summary how all the explanatory variables are distributed. As we can see they are on different scales, especially "population" and "Internet usage". As we don't want to have the following analysis be more driven on the larges distances, we scale them by $\frac{(x - mean(x))}{sd(x)}$

```{r echo=FALSE}
summary(data_2018[,correlation_categories])
```
```{r echo=FALSE, fig.height=8, fig.width=10, message=FALSE, warning=FALSE}
scaled_data_factors <- data.frame(scale(data_2018[,correlation_categories]))

data_long <- melt(scaled_data_factors) 
ggplot(data_long, aes(x = variable, y = value)) +
  geom_boxplot()

```


```{r}
box <- ggplot(data_2018, aes(x = Region, y = Happiness, color = Region), ) +
  geom_boxplot() + 
  geom_jitter(aes(color=Country), size = 0.5) +
  ggtitle("Happiness Score for Regions and Countries") + 
  coord_flip() + 
  theme(legend.position="none")
ggplotly(box)
```
```{r}
colnames(data_2018)
correlation_data <- data_2018[,correlation_categories]
ggpairs(correlation_data, title="correlation matrix for influential factors analysis", )
```



### correlation matrices
### regression
### PCA (Colour by region) + biplot (or PLS)
### SOM (2018)

## Happiness over time?

geography map (color each country base on the percentage change over time (2015-2022))



## What influences happiness

## Future work